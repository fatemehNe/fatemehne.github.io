{{ define "main" }}
<section class="cards-page">
  <header class="cards-header">
    {{ partial "breadcrumbs.html" . }}
    <h1>{{ .Title }}</h1>
    {{ if or .Description .Content }}
    <div class="cards-intro">
      {{ with .Description }}<p>{{ . }}</p>{{ end }}
      {{ if .Content }}{{ .Content | markdownify }}{{ end }}
    </div>
    {{ end }}
  </header>

  {{ $paginator := .Paginate .RegularPages }}
  {{ if gt (len $paginator.Pages) 0 }}
  <div class="cards-grid">
    {{ range $paginator.Pages }}
    {{ $thumb := "" }}
    {{ with .Params.thumbnail }}{{ $thumb = . }}{{ end }}
    {{ with $c := .Params.cover }}
      {{ if and (not $thumb) (reflect.IsMap $c) }}
        {{ with $c.image }}{{ $thumb = . }}{{ end }}
      {{ else if and (not $thumb) (not (reflect.IsMap $c)) }}
        {{ $thumb = $c }}
      {{ end }}
    {{ end }}
    <article class="card">
      <a class="card-link" href="{{ .RelPermalink }}">
        <div class="card-thumb {{ if not $thumb }}card-thumb--empty{{ end }}" {{ if $thumb }}style="background-image: url('{{ $thumb | absURL }}');"{{ end }}></div>
        <div class="card-body">
          <h2 class="card-title">
            {{ .Title }}
            {{ if .Draft }}<span class="card-draft">Draft</span>{{ end }}
          </h2>
          <p class="card-submeta">
            {{ (.Date | time).Format "Jan 2, 2006" }} · {{ .Params.author | default site.Params.author }}
          </p>
          {{ with .Description }}
          <p class="card-meta">{{ . }}</p>
          {{ else }}
          {{ with .Summary }}<p class="card-meta">{{ . | plainify | htmlUnescape }}</p>{{ end }}
          {{ end }}
        </div>
      </a>
    </article>
    {{ end }}
  </div>

  {{ if gt $paginator.TotalPages 1 }}
  <nav class="cards-pagination">
    {{ if $paginator.HasPrev }}
    <a class="page-link prev" href="{{ $paginator.Prev.URL | absURL }}">← Newer</a>
    {{ end }}
    <span class="page-count">Page {{ $paginator.PageNumber }} of {{ $paginator.TotalPages }}</span>
    {{ if $paginator.HasNext }}
    <a class="page-link next" href="{{ $paginator.Next.URL | absURL }}">Older →</a>
    {{ end }}
  </nav>
  {{ end }}
  {{ else }}
  <p class="cards-empty">Talk details will appear here soon.</p>
  {{ end }}
</section>
{{ end }}
